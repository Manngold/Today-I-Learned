# Process

일반적으로 프로세스는 `실행 중인 프로그램`으로 정의한다

프로그램은 디스크 상에 존재하고 실행을 하기 위한 명령어와 정적 데이터의 묶음이다

결국 프로세스는 명령어와 데이터의 묶음인 프로그램을 읽고 실행하여 `프로그램에 생명을 불어넣는 것`이 운영체제이다.

그렇다면 다음 의문은 적은 개수의 CPU로 어떻게 여러 프로세스를 실행할 수 있는걸까?

바로 프로세스를 실행/중단 하면서 여러 개의 프로세스를 번갈아가면서 처리하는 것이다.

이것을 바로 `time sharing` 기법이라고 한다 이 때, CPU를 공유하기 때문에 프로세스의 성능은 낮아지게 된다

나중에 나오지만 time sharing을 위한 메커니즘으로 `context switch`가 존재한다

> time sharing vs space sharing
>
> time sharing : 하나의 개체가 자원을 사용하고 이어서 다른 개체가 사용하는 방식
>
> space sharing : 개체에게 공간을 할당해주는 것 ex) 디스크

## 프로세스의 개념

앞서 말했듯이 `실행 중인 프로그램 = Process`

더 나아가 프로세스의 구성 요소를 이해하려면 하드웨어 상태를 이해해야 한다.

`프로그램이 실행되는 동안(프로세스는) 하드웨어 상태를 읽거나 갱신할 수 있다`를 파악하기 위해서 하드웨어 상태의 구성요소를 알아보자

1. 메모리 : 명령어 저장, 실행 프로그램이 읽고 쓰는 데이터 저장

2. 레지스터 : 많은 명령어들이 레지스터를 직접 읽거나 갱신

    - Program Counter : 프로그램의 어느 명령어가 실행 중인지를 알려줌
    - Stack Pointer, Frame Pointer : 함수의 변수와 리턴 주소를 저장하는 스택을 관리할 때 사용하는 레지스터

## 프로세스 API

1. Create : 새로운 프로세스 생성

2. Destroy : 프로세스가 할 일을 다 하면 알아서 제거가 되지만 스스로 종료되지 못할 경우 사용자가 제거를 하는 API

3. Wait : 프로세스 대기

4. Miscellaneous Control : 프로세스의 제거 , 대기 외 여러 제어 기능 제공(일시정지, 재실행 등..)

5. Status: 프로세스 상태 정보를 얻어내는 기능 (얼마 동안 실행되었나, 어떤 상태인가)

## 프로그램은 어떻게 프로세스가 되는가

프로그램 실행을 위해서 우선 메모리, 프로세스 주소 공간에 프로그램 코드와 정적 데이터를 탑재한다

코드와 정적 데이터가 메모리에 탑재된 후, 일정량의 메모리가 프로그램의 `run-time stack` 혹은 `stack`용도로 할당되어야 한다.(C 프로그램은 지역변수, 함수 인자, 리턴 주소등을 스택에 저장하기 때문에 main() 함수의 인자인 argc와 argv 벡터를 사용해서 스택 초기화함)

`heap`을 위한 메모리 영역을 할당한다. 힙은 동적으로 할당된 데이터를 저장하기 위해서 사용된다 (malloc()으로 할당 free()로 반환하여 가변적인 자료 구조를 위해 사용된다)

입출력과 관계된 초기화 작업을 수행한다 (STDIN STDOUT STDERR에 해당하는 세 개의 `파일 디스크립터`를 갖는다)

정리하자면

`코드와 정적 데이터를 메모리에 탑재 -> 스택과 힙을 생성/초기화 -> 입출력 셋업과 관계된 다른 작업 -> main()부터 프로그램 실행`

## 프로세스 상태

1. Running : 프로세스가 프로세서에서 실행 중

2. Ready : 프로세스가 실행 될 준비가 되어 있지만 운영체제가 다른 프로세스를 실행하고 있는 등의 이유로 대기

3. Blocked : 프로세스가 다른 사건을 기다리는 동안 프로세스의 수행을 중단시키는 연산 ex) 디스크에 대한 입출력 요청시 입출력이 완료될 때까지 대기 상태

-   more
    -   init : 프로세스가 생성되는 동안의 상태
    -   final : 프로세스가 종료되었는데 메모리에 남은 상태(zombie라고도 불린다)
    -

## 자료 구조

운영체제도 일종의 프로그램이기 때문에 다양한 정보를 유지하기 위해서 자료 구조를 갖는다

프로세스의 관리를 위한 정보를 저장하는 `PCB(Process Control Block`가 존재하는데

프로세스의 상태, 어디까지 실행 되었는지, 프로세스의 id 등 여러 정보가 존재한다
